(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";var t=e.Pos;function n(e,n,r,o){this.atOccurrence=false;this.doc=e;if(o==null&&typeof n=="string")o=false;r=r?e.clipPos(r):t(0,0);this.pos={from:r,to:r};if(typeof n!="string"){if(!n.global)n=new RegExp(n.source,n.ignoreCase?"ig":"g");this.matches=function(i,r){if(i){n.lastIndex=0;var o=e.getLine(r.line).slice(0,r.ch),s=0,f,l;for(;;){n.lastIndex=s;var h=n.exec(o);if(!h)break;f=h;l=f.index;s=f.index+(f[0].length||1);if(s==o.length)break}var c=f&&f[0].length||0;if(!c){if(l==0&&o.length==0){f=undefined}else if(l!=e.getLine(r.line).length){c++}}}else{n.lastIndex=r.ch;var o=e.getLine(r.line),f=n.exec(o);var c=f&&f[0].length||0;var l=f&&f.index;if(l+c!=o.length&&!c)c=1}if(f&&c)return{from:t(r.line,l),to:t(r.line,l+c),match:f}}}else{var s=n;if(o)n=n.toLowerCase();var f=o?function(e){return e.toLowerCase()}:function(e){return e};var l=n.split("\n");if(l.length==1){if(!n.length){this.matches=function(){}}else{this.matches=function(r,o){if(r){var l=e.getLine(o.line).slice(0,o.ch),h=f(l);var c=h.lastIndexOf(n);if(c>-1){c=i(l,h,c);return{from:t(o.line,c),to:t(o.line,c+s.length)}}}else{var l=e.getLine(o.line).slice(o.ch),h=f(l);var c=h.indexOf(n);if(c>-1){c=i(l,h,c)+o.ch;return{from:t(o.line,c),to:t(o.line,c+s.length)}}}}}}else{var h=s.split("\n");this.matches=function(n,i){var r=l.length-1;if(n){if(i.line-(l.length-1)<e.firstLine())return;if(f(e.getLine(i.line).slice(0,h[r].length))!=l[l.length-1])return;var o=t(i.line,h[r].length);for(var s=i.line-1,c=r-1;c>=1;--c,--s)if(l[c]!=f(e.getLine(s)))return;var a=e.getLine(s),u=a.length-h[0].length;if(f(a.slice(u))!=l[0])return;return{from:t(s,u),to:o}}else{if(i.line+(l.length-1)>e.lastLine())return;var a=e.getLine(i.line),u=a.length-h[0].length;if(f(a.slice(u))!=l[0])return;var g=t(i.line,u);for(var s=i.line+1,c=1;c<r;++c,++s)if(l[c]!=f(e.getLine(s)))return;if(f(e.getLine(s).slice(0,h[r].length))!=l[r])return;return{from:g,to:t(s,h[r].length)}}}}}}n.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(e){var n=this,i=this.doc.clipPos(e?this.pos.from:this.pos.to);function r(e){var i=t(e,0);n.pos={from:i,to:i};n.atOccurrence=false;return false}for(;;){if(this.pos=this.matches(e,i)){this.atOccurrence=true;return this.pos.match||true}if(e){if(!i.line)return r(0);i=t(i.line-1,this.doc.getLine(i.line-1).length)}else{var o=this.doc.lineCount();if(i.line==o-1)return r(o);i=t(i.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(n){if(!this.atOccurrence)return;var i=e.splitLines(n);this.doc.replaceRange(i,this.pos.from,this.pos.to);this.pos.to=t(this.pos.from.line+i.length-1,i[i.length-1].length+(i.length==1?this.pos.from.ch:0))}};function i(e,t,n){if(e.length==t.length)return n;for(var i=Math.min(n,e.length);;){var r=e.slice(0,i).toLowerCase().length;if(r<n)++i;else if(r>n)--i;else return i}}e.defineExtension("getSearchCursor",function(e,t,i){return new n(this.doc,e,t,i)});e.defineDocExtension("getSearchCursor",function(e,t,i){return new n(this,e,t,i)});e.defineExtension("selectMatches",function(t,n){var i=[],r;var o=this.getSearchCursor(t,this.getCursor("from"),n);while(r=o.findNext()){if(e.cmpPos(o.to(),this.getCursor("to"))>0)break;i.push({anchor:o.from(),head:o.to()})}if(i.length)this.setSelections(i,0)})});
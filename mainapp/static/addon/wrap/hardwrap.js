(function(r){if(typeof exports=="object"&&typeof module=="object")r(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],r);else r(CodeMirror)})(function(r){"use strict";var e=r.Pos;function t(r,e,t){var n=t.paragraphStart||r.getHelper(e,"paragraphStart");for(var a=e.line,o=r.firstLine();a>o;--a){var i=r.getLine(a);if(n&&n.test(i))break;if(!/\S/.test(i)){++a;break}}var f=t.paragraphEnd||r.getHelper(e,"paragraphEnd");for(var l=e.line+1,s=r.lastLine();l<=s;++l){var i=r.getLine(l);if(f&&f.test(i)){++l;break}if(!/\S/.test(i))break}return{from:a,to:l}}function n(r,e,t,n){for(var a=e;a>0;--a)if(t.test(r.slice(a-1,a+1)))break;if(a==0)a=e;var o=a;if(n)while(r.charAt(o-1)==" ")--o;return{from:o,to:a}}function a(t,a,o,i){a=t.clipPos(a);o=t.clipPos(o);var f=i.column||80;var l=i.wrapOn||/\s\S|-[^\.\d]/;var s=i.killTrailingSpace!==false;var h=[],c="",g=a.line;var p=t.getRange(a,o,false);if(!p.length)return null;var v=p[0].match(/^[ \t]*/)[0];for(var u=0;u<p.length;++u){var m=p[u],d=c.length,b=0;if(c&&m&&!l.test(c.charAt(c.length-1)+m.charAt(0))){c+=" ";b=1}var w="";if(u){w=m.match(/^\s*/)[0];m=m.slice(w.length)}c+=m;if(u){var x=c.length>f&&v==w&&n(c,f,l,s);if(!x||x.from!=d||x.to!=d+b){h.push({text:[b?" ":""],from:e(g,d),to:e(g+1,w.length)})}else{c=v+m;++g}}while(c.length>f){var S=n(c,f,l,s);h.push({text:["",v],from:e(g,S.from),to:e(g,S.to)});c=v+c.slice(S.to);++g}}if(h.length)t.operation(function(){for(var r=0;r<h.length;++r){var e=h[r];t.replaceRange(e.text,e.from,e.to)}});return h.length?{from:h[0].from,to:r.changeEnd(h[h.length-1])}:null}r.defineExtension("wrapParagraph",function(r,n){n=n||{};if(!r)r=this.getCursor();var o=t(this,r,n);return a(this,e(o.from,0),e(o.to-1),n)});r.commands.wrapLines=function(r){r.operation(function(){var n=r.listSelections(),o=r.lastLine()+1;for(var i=n.length-1;i>=0;i--){var f=n[i],l;if(f.empty()){var s=t(r,f.head,{});l={from:e(s.from,0),to:e(s.to-1)}}else{l={from:f.from(),to:f.to()}}if(l.to.line>=o)continue;o=l.from.line;a(r,l.from,l.to,{})}})};r.defineExtension("wrapRange",function(r,e,t){return a(this,r,e,t||{})});r.defineExtension("wrapParagraphsInRange",function(r,n,o){o=o||{};var i=this,f=[];for(var l=r.line;l<=n.line;){var s=t(i,e(l,0),o);f.push(s);l=s.to}var h=false;if(f.length)i.operation(function(){for(var r=f.length-1;r>=0;--r)h=h||a(i,e(f[r].from,0),e(f[r].to-1),o)});return h})});
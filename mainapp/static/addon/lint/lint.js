(function(t){if(typeof exports=="object"&&typeof module=="object")t(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],t);else t(CodeMirror)})(function(t){"use strict";var e="CodeMirror-lint-markers";function n(e,n){var o=document.createElement("div");o.className="CodeMirror-lint-tooltip";o.appendChild(n.cloneNode(true));document.body.appendChild(o);function r(e){if(!o.parentNode)return t.off(document,"mousemove",r);o.style.top=Math.max(0,e.clientY-o.offsetHeight-5)+"px";o.style.left=e.clientX+5+"px"}t.on(document,"mousemove",r);r(e);if(o.style.opacity!=null)o.style.opacity=1;return o}function o(t){if(t.parentNode)t.parentNode.removeChild(t)}function r(t){if(!t.parentNode)return;if(t.style.opacity==null)o(t);t.style.opacity=0;setTimeout(function(){o(t)},600)}function i(e,o,i){var a=n(e,o);function f(){t.off(i,"mouseout",f);if(a){r(a);a=null}}var l=setInterval(function(){if(a)for(var t=i;;t=t.parentNode){if(t==document.body)return;if(!t){f();break}}if(!a)return clearInterval(l)},400);t.on(i,"mouseout",f)}function a(t,e,n){this.marked=[];this.options=e;this.timeout=null;this.hasGutter=n;this.onMouseOver=function(e){y(t,e)}}function f(e,n){if(n instanceof Function)return{getAnnotations:n};if(!n||n===true)n={};if(!n.getAnnotations)n.getAnnotations=e.getHelper(t.Pos(0,0),"lint");if(!n.getAnnotations)throw new Error("Required option 'getAnnotations' missing (lint addon)");return n}function l(t){var n=t.state.lint;if(n.hasGutter)t.clearGutter(e);for(var o=0;o<n.marked.length;++o)n.marked[o].clear();n.marked.length=0}function s(e,n,o,r){var a=document.createElement("div"),f=a;a.className="CodeMirror-lint-marker-"+n;if(o){f=a.appendChild(document.createElement("div"));f.className="CodeMirror-lint-marker-multiple"}if(r!=false)t.on(f,"mouseover",function(t){i(t,e,f)});return a}function u(t,e){if(t=="error")return t;else return e}function c(t){var e=[];for(var n=0;n<t.length;++n){var o=t[n],r=o.from.line;(e[r]||(e[r]=[])).push(o)}return e}function m(t){var e=t.severity;if(!e)e="error";var n=document.createElement("div");n.className="CodeMirror-lint-message-"+e;n.appendChild(document.createTextNode(t.message));return n}function d(t){var e=t.state.lint,n=e.options;if(n.async)n.getAnnotations(t,p,n);else p(t,n.getAnnotations(t.getValue(),n.options))}function p(t,n){l(t);var o=t.state.lint,r=o.options;var i=c(n);for(var a=0;a<i.length;++a){var f=i[a];if(!f)continue;var d=null;var p=o.hasGutter&&document.createDocumentFragment();for(var v=0;v<f.length;++v){var g=f[v];var h=g.severity;if(!h)h="error";d=u(d,h);if(r.formatAnnotation)g=r.formatAnnotation(g);if(o.hasGutter)p.appendChild(m(g));if(g.to)o.marked.push(t.markText(g.from,g.to,{className:"CodeMirror-lint-mark-"+h,__annotation:g}))}if(o.hasGutter)t.setGutterMarker(a,e,s(p,d,f.length>1,o.options.tooltips))}if(r.onUpdateLinting)r.onUpdateLinting(n,i,t)}function v(t){var e=t.state.lint;clearTimeout(e.timeout);e.timeout=setTimeout(function(){d(t)},e.options.delay||500)}function g(t,e){var n=e.target||e.srcElement;i(e,m(t),n)}var h=[0,0,0,5,0,-5,5,0,-5,0];function y(t,e){if(!/\bCodeMirror-lint-mark-/.test((e.target||e.srcElement).className))return;for(var n=0;n<h.length;n+=2){var o=t.findMarksAt(t.coordsChar({left:e.clientX+h[n],top:e.clientY+h[n+1]},"client"));for(var r=0;r<o.length;++r){var i=o[r],a=i.__annotation;if(a)return g(a,e)}}}t.defineOption("lint",false,function(n,o,r){if(r&&r!=t.Init){l(n);n.off("change",v);t.off(n.getWrapperElement(),"mouseover",n.state.lint.onMouseOver);delete n.state.lint}if(o){var i=n.getOption("gutters"),s=false;for(var u=0;u<i.length;++u)if(i[u]==e)s=true;var c=n.state.lint=new a(n,f(n,o),s);n.on("change",v);if(c.options.tooltips!=false)t.on(n.getWrapperElement(),"mouseover",c.onMouseOver);d(n)}})});
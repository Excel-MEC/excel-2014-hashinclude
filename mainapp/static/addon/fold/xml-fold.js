(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";var n=e.Pos;function t(e,n){return e.line-n.line||e.ch-n.ch}var r="A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD";var i=r+"-:.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040";var f=new RegExp("<(/?)(["+r+"]["+i+"]*)","g");function u(e,n,t,r){this.line=n;this.ch=t;this.cm=e;this.text=e.getLine(n);this.min=r?r.from:e.firstLine();this.max=r?r.to-1:e.lastLine()}function o(e,t){var r=e.cm.getTokenTypeAt(n(e.line,t));return r&&/\btag\b/.test(r)}function c(e){if(e.line>=e.max)return;e.ch=0;e.text=e.cm.getLine(++e.line);return true}function l(e){if(e.line<=e.min)return;e.text=e.cm.getLine(--e.line);e.ch=e.text.length;return true}function a(e){for(;;){var n=e.text.indexOf(">",e.ch);if(n==-1){if(c(e))continue;else return}if(!o(e,n+1)){e.ch=n+1;continue}var t=e.text.lastIndexOf("/",n);var r=t>-1&&!/\S/.test(e.text.slice(t+1,n));e.ch=n+1;return r?"selfClose":"regular"}}function s(e){for(;;){var n=e.ch?e.text.lastIndexOf("<",e.ch-1):-1;if(n==-1){if(l(e))continue;else return}if(!o(e,n+1)){e.ch=n;continue}f.lastIndex=n;e.ch=n;var t=f.exec(e.text);if(t&&t.index==n)return t}}function h(e){for(;;){f.lastIndex=e.ch;var n=f.exec(e.text);if(!n){if(c(e))continue;else return}if(!o(e,n.index+1)){e.ch=n.index+1;continue}e.ch=n.index+n[0].length;return n}}function v(e){for(;;){var n=e.ch?e.text.lastIndexOf(">",e.ch-1):-1;if(n==-1){if(l(e))continue;else return}if(!o(e,n+1)){e.ch=n;continue}var t=e.text.lastIndexOf("/",n);var r=t>-1&&!/\S/.test(e.text.slice(t+1,n));e.ch=n+1;return r?"selfClose":"regular"}}function x(e,t){var r=[];for(;;){var i=h(e),f,u=e.line,o=e.ch-(i?i[0].length:0);if(!i||!(f=a(e)))return;if(f=="selfClose")continue;if(i[1]){for(var c=r.length-1;c>=0;--c)if(r[c]==i[2]){r.length=c;break}if(c<0&&(!t||t==i[2]))return{tag:i[2],from:n(u,o),to:n(e.line,e.ch)}}else{r.push(i[2])}}}function g(e,t){var r=[];for(;;){var i=v(e);if(!i)return;if(i=="selfClose"){s(e);continue}var f=e.line,u=e.ch;var o=s(e);if(!o)return;if(o[1]){r.push(o[2])}else{for(var c=r.length-1;c>=0;--c)if(r[c]==o[2]){r.length=c;break}if(c<0&&(!t||t==o[2]))return{tag:o[2],from:n(e.line,e.ch),to:n(f,u)}}}}e.registerHelper("fold","xml",function(e,t){var r=new u(e,t.line,0);for(;;){var i=h(r),f;if(!i||r.line!=t.line||!(f=a(r)))return;if(!i[1]&&f!="selfClose"){var t=n(r.line,r.ch);var o=x(r,i[2]);return o&&{from:t,to:o.from}}}});e.findMatchingTag=function(e,r,i){var f=new u(e,r.line,r.ch,i);if(f.text.indexOf(">")==-1&&f.text.indexOf("<")==-1)return;var o=a(f),c=o&&n(f.line,f.ch);var l=o&&s(f);if(!o||!l||t(f,r)>0)return;var h={from:n(f.line,f.ch),to:c,tag:l[2]};if(o=="selfClose")return{open:h,close:null,at:"open"};if(l[1]){return{open:g(f,l[2]),close:h,at:"close"}}else{f=new u(e,c.line,c.ch,i);return{open:h,close:x(f,l[2]),at:"open"}}};e.findEnclosingTag=function(e,n,t){var r=new u(e,n.line,n.ch,t);for(;;){var i=g(r);if(!i)break;var f=new u(e,n.line,n.ch,t);var o=x(f,i.tag);if(o)return{open:i,close:o}}};e.scanForClosingTag=function(e,n,t,r){var i=new u(e,n.line,n.ch,r?{from:0,to:r}:null);return x(i,t)}});
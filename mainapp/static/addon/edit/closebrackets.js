(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){var n="()[]{}''\"\"";var t="[]{}";var r=/\s/;var i=e.Pos;e.defineOption("autoCloseBrackets",false,function(r,i,a){if(a!=e.Init&&a)r.removeKeyMap("autoCloseBrackets");if(!i)return;var o=n,f=t;if(typeof i=="string")o=i;else if(typeof i=="object"){if(i.pairs!=null)o=i.pairs;if(i.explode!=null)f=i.explode}var c=s(o);if(f)c.Enter=l(f);r.addKeyMap(c)});function a(e,n){var t=e.getRange(i(n.line,n.ch-1),i(n.line,n.ch+1));return t.length==2?t:null}function o(n,t,r){var i=n.getLine(t.line);var a=n.getTokenAt(t);if(/\bstring2?\b/.test(a.type))return false;var o=new e.StringStream(i.slice(0,t.ch)+r+i.slice(t.ch),4);o.pos=o.start=a.start;for(;;){var s=n.getMode().token(o,a.state);if(o.pos>=t.ch+1)return/\bstring2?\b/.test(s);o.start=o.pos}}function s(n){var t={name:"autoCloseBrackets",Backspace:function(t){if(t.getOption("disableInput"))return e.Pass;var r=t.listSelections();for(var o=0;o<r.length;o++){if(!r[o].empty())return e.Pass;var s=a(t,r[o].head);if(!s||n.indexOf(s)%2!=0)return e.Pass}for(var o=r.length-1;o>=0;o--){var l=r[o].head;t.replaceRange("",i(l.line,l.ch-1),i(l.line,l.ch+1))}}};var s="";for(var l=0;l<n.length;l+=2)(function(n,a){if(n!=a)s+=a;t["'"+n+"'"]=function(t){if(t.getOption("disableInput"))return e.Pass;var l=t.listSelections(),f,c;for(var u=0;u<l.length;u++){var h=l[u],g=h.head,d;var c=t.getRange(g,i(g.line,g.ch+1));if(!h.empty())d="surround";else if(n==a&&c==a){if(t.getRange(g,i(g.line,g.ch+3))==n+n+n)d="skipThree";else d="skip"}else if(n==a&&g.ch>1&&t.getRange(i(g.line,g.ch-2),g)==n+n&&(g.ch<=2||t.getRange(i(g.line,g.ch-3),i(g.line,g.ch-2))!=n))d="addFour";else if(n=='"'||n=="'"){if(!e.isWordChar(c)&&o(t,g,n))d="both";else return e.Pass}else if(t.getLine(g.line).length==g.ch||s.indexOf(c)>=0||r.test(c))d="both";else return e.Pass;if(!f)f=d;else if(f!=d)return e.Pass}t.operation(function(){if(f=="skip"){t.execCommand("goCharRight")}else if(f=="skipThree"){for(var e=0;e<3;e++)t.execCommand("goCharRight")}else if(f=="surround"){var r=t.getSelections();for(var e=0;e<r.length;e++)r[e]=n+r[e]+a;t.replaceSelections(r,"around")}else if(f=="both"){t.replaceSelection(n+a,null);t.execCommand("goCharLeft")}else if(f=="addFour"){t.replaceSelection(n+n+n+n,"before");t.execCommand("goCharRight")}})};if(n!=a)t["'"+a+"'"]=function(n){var t=n.listSelections();for(var r=0;r<t.length;r++){var o=t[r];if(!o.empty()||n.getRange(o.head,i(o.head.line,o.head.ch+1))!=a)return e.Pass}n.execCommand("goCharRight")}})(n.charAt(l),n.charAt(l+1));return t}function l(n){return function(t){if(t.getOption("disableInput"))return e.Pass;var r=t.listSelections();for(var i=0;i<r.length;i++){if(!r[i].empty())return e.Pass;var o=a(t,r[i].head);if(!o||n.indexOf(o)%2!=0)return e.Pass}t.operation(function(){t.replaceSelection("\n\n",null);t.execCommand("goCharLeft");r=t.listSelections();for(var e=0;e<r.length;e++){var n=r[e].head.line;t.indentLine(n,null,true);t.indentLine(n+1,null,true)}})}}});
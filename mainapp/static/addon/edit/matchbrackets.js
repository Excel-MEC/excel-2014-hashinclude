(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){var t=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8);var n=e.Pos;var r={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function i(e,t,i,o){var c=e.getLineHandle(t.line),f=t.ch-1;var l=f>=0&&r[c.text.charAt(f)]||r[c.text.charAt(++f)];if(!l)return null;var s=l.charAt(1)==">"?1:-1;if(i&&s>0!=(f==t.ch))return null;var u=e.getTokenTypeAt(n(t.line,f+1));var h=a(e,n(t.line,f+(s>0?1:0)),s,u||null,o);if(h==null)return null;return{from:n(t.line,f),to:h&&h.pos,match:h&&h.ch==l.charAt(0),forward:s>0}}function a(e,t,i,a,o){var c=o&&o.maxScanLineLength||1e4;var f=o&&o.maxScanLines||1e3;var l=[];var s=o&&o.bracketRegex?o.bracketRegex:/[(){}[\]]/;var u=i>0?Math.min(t.line+f,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-f);for(var h=t.line;h!=u;h+=i){var m=e.getLine(h);if(!m)continue;var d=i>0?0:m.length-1,v=i>0?m.length:-1;if(m.length>c)continue;if(h==t.line)d=t.ch-(i<0?1:0);for(;d!=v;d+=i){var g=m.charAt(d);if(s.test(g)&&(a===undefined||e.getTokenTypeAt(n(h,d+1))==a)){var p=r[g];if(p.charAt(1)==">"==i>0)l.push(g);else if(!l.length)return{pos:n(h,d),ch:g};else l.pop()}}}return h-i==(i>0?e.lastLine():e.firstLine())?false:null}function o(e,r,a){var o=e.state.matchBrackets.maxHighlightLineLength||1e3;var c=[],f=e.listSelections();for(var l=0;l<f.length;l++){var s=f[l].empty()&&i(e,f[l].head,false,a);if(s&&e.getLine(s.from.line).length<=o){var u=s.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";c.push(e.markText(s.from,n(s.from.line,s.from.ch+1),{className:u}));if(s.to&&e.getLine(s.to.line).length<=o)c.push(e.markText(s.to,n(s.to.line,s.to.ch+1),{className:u}))}}if(c.length){if(t&&e.state.focused)e.display.input.focus();var h=function(){e.operation(function(){for(var e=0;e<c.length;e++)c[e].clear()})};if(r)setTimeout(h,800);else return h}}var c=null;function f(e){e.operation(function(){if(c){c();c=null}c=o(e,false,e.state.matchBrackets)})}e.defineOption("matchBrackets",false,function(t,n,r){if(r&&r!=e.Init)t.off("cursorActivity",f);if(n){t.state.matchBrackets=typeof n=="object"?n:{};t.on("cursorActivity",f)}});e.defineExtension("matchBrackets",function(){o(this,true)});e.defineExtension("findMatchingBracket",function(e,t,n){return i(this,e,t,n)});e.defineExtension("scanForBracket",function(e,t,n,r){return a(this,e,t,n,r)})});
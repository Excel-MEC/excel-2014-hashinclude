(function(t){if(typeof exports=="object"&&typeof module=="object")t(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],t);else t(CodeMirror)})(function(t){"use strict";var e=t.Pos;function r(r,i){var s=i&&i.schemaInfo;var a=i&&i.quoteChar||'"';if(!s)return;var n=r.getCursor(),f=r.getTokenAt(n);var o=t.innerMode(r.getMode(),f.state);if(o.mode.name!="xml")return;var l=[],g=false,c;var u=/\btag\b/.test(f.type),h=u&&/^\w/.test(f.string),p;if(h){var v=r.getLine(n.line).slice(Math.max(0,f.start-2),f.start);var d=/<\/$/.test(v)?"close":/<$/.test(v)?"open":null;if(d)p=f.start-(d=="close"?2:1)}else if(u&&f.string=="<"){d="open"}else if(u&&f.string=="</"){d="close"}if(!u&&!o.state.tagName||d){if(h)c=f.string;g=d;var m=o.state.context,y=m&&s[m.tagName];var x=m?y&&y.children:s["!top"];if(x&&d!="close"){for(var O=0;O<x.length;++O)if(!c||x[O].lastIndexOf(c,0)==0)l.push("<"+x[O])}else if(d!="close"){for(var b in s)if(s.hasOwnProperty(b)&&b!="!top"&&b!="!attrs"&&(!c||b.lastIndexOf(c,0)==0))l.push("<"+b)}if(m&&(!c||d=="close"&&m.tagName.lastIndexOf(c,0)==0))l.push("</"+m.tagName+">")}else{var y=s[o.state.tagName],w=y&&y.attrs;var I=s["!attrs"];if(!w&&!I)return;if(!w){w=I}else if(I){var P={};for(var A in I)if(I.hasOwnProperty(A))P[A]=I[A];for(var A in w)if(w.hasOwnProperty(A))P[A]=w[A];w=P}if(f.type=="string"||f.string=="="){var v=r.getRange(e(n.line,Math.max(0,n.ch-60)),e(n.line,f.type=="string"?f.start:f.end));var M=v.match(/([^\s\u00a0=<>\"\']+)=$/),N;if(!M||!w.hasOwnProperty(M[1])||!(N=w[M[1]]))return;if(typeof N=="function")N=N.call(this,r);if(f.type=="string"){c=f.string;var C=0;if(/['"]/.test(f.string.charAt(0))){a=f.string.charAt(0);c=f.string.slice(1);C++}var $=f.string.length;if(/['"]/.test(f.string.charAt($-1))){a=f.string.charAt($-1);c=f.string.substr(C,$-2)}g=true}for(var O=0;O<N.length;++O)if(!c||N[O].lastIndexOf(c,0)==0)l.push(a+N[O]+a)}else{if(f.type=="attribute"){c=f.string;g=true}for(var j in w)if(w.hasOwnProperty(j)&&(!c||j.lastIndexOf(c,0)==0))l.push(j)}}return{list:l,from:g?e(n.line,p==null?f.start:p):n,to:g?e(n.line,f.end):n}}t.registerHelper("hint","xml",r)});
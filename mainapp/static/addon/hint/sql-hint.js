(function(r){if(typeof exports=="object"&&typeof module=="object")r(require("../../lib/codemirror"),require("../../mode/sql/sql"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../../mode/sql/sql"],r);else r(CodeMirror)})(function(r){"use strict";var e;var t;var n={QUERY_DIV:";",ALIAS_KEYWORD:"AS"};var i=r.Pos;function a(e){var t=e.doc.modeOption;if(t==="sql")t="text/x-sql";return r.resolveMode(t).keywords}function o(r,e){var t=r.length;var n=e.substr(0,t);return r.toUpperCase()===n.toUpperCase()}function s(r,e,t,n){for(var i in t){if(!t.hasOwnProperty(i))continue;if(Array.isArray(t)){i=t[i]}if(o(e,i)){r.push(n(i))}}}function f(r,t){var n=t.getCursor();var a=t.getTokenAt(n);var o=a.string.substr(1);var f=i(n.line,a.start);var l=t.getTokenAt(f).string;if(!e.hasOwnProperty(l))l=c(l,t);var u=e[l];if(!u)return;s(r,o,u,function(r){return"."+r})}function l(r,e){if(!r)return;var t=/[,;]/g;var n=r.split(" ");for(var i=0;i<n.length;i++){e(n[i]?n[i].replace(t,""):"")}}function u(r){return r.line+r.ch/Math.pow(10,6)}function v(r){return i(Math.floor(r),+r.toString().split(".").pop())}function c(r,t){var a=t.doc;var o=a.getValue();var s=r.toUpperCase();var f="";var c="";var p=[];var g={start:i(0,0),end:i(t.lastLine(),t.getLineHandle(t.lastLine()).length)};var d=o.indexOf(n.QUERY_DIV);while(d!=-1){p.push(a.posFromIndex(d));d=o.indexOf(n.QUERY_DIV,d+1)}p.unshift(i(0,0));p.push(i(t.lastLine(),t.getLineHandle(t.lastLine()).text.length));var h=0;var A=u(t.getCursor());for(var m=0;m<p.length;m++){var b=u(p[m]);if(A>h&&A<=b){g={start:v(h),end:v(b)};break}h=b}var q=a.getRange(g.start,g.end,false);for(var m=0;m<q.length;m++){var w=q[m];l(w,function(r){var t=r.toUpperCase();if(t===s&&e.hasOwnProperty(f)){c=f}if(t!==n.ALIAS_KEYWORD){f=r}});if(c)break}return c}r.registerHelper("hint","sql",function(r,n){e=n&&n.tables||{};t=t||a(r);var o=r.getCursor();var l=[];var u=r.getTokenAt(o),v,c,p;if(u.string.match(/^[.\w@]\w*$/)){p=u.string;v=u.start;c=u.end}else{v=c=o.ch;p=""}if(p.charAt(0)=="."){f(l,r);if(!l.length){while(v&&p.charAt(0)=="."){u=r.getTokenAt(i(o.line,u.start-1));v=u.start;p=u.string+p}s(l,p,e,function(r){return r})}}else{s(l,p,e,function(r){return r});s(l,p,t,function(r){return r.toUpperCase()})}return{list:l,from:i(o.line,v),to:i(o.line,c)}})});